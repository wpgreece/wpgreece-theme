/*
 * jquery.nevma.popup 1.2 - Simple, flexible, powerful popup plugin.
 * 
 * Copyright (c) 2012 Nevma.Gr
 * http://www.nevma.gr
 *
 * All right reserved!
 * 
 */

jQuery.fn.popup=function(B,D){function t(a,c){var b=null;return function(){var e=this,d=arguments;clearTimeout(b);b=setTimeout(function(){a.apply(e,d)},c)}}function u(a,c){var b,d;b=(jQuery(window).width()-a)/2;d=(jQuery(window).height()-c)/2;return{x:b,y:d}}function m(b){var c="popup-overlay-"+a.ID;f=jQuery("#"+c);0==f.length&&(jQuery(document.body).append('<div id = "'+c+'" class = "'+a.overlayElementClass+'"></div>'),f=jQuery("#"+c),v=f.css("opacity"),f.css("display","block").css("position","fixed").css("opacity",
0).css("z-index",a.startZIndex).css("top","0").css("left","0"),f.click(function(){h()}));f.css("display","block").css("width",jQuery(window).width()).css("height",jQuery(window).height());f.animate({opacity:""+v},{queue:!1,duration:a.animationDuration,easing:a.animationEasing,complete:function(){b&&b()}})}function C(b){f.animate({opacity:0},{queue:!1,duration:a.animationDuration,easing:a.animationEasing,complete:function(){f.css("display","none");b&&b()}})}function n(){var b="temp-popup-contents-"+
(new Date).getTime();jQuery(document.body).append('<div class = "'+a.popupContentsElementClass+'" id = "'+b+'" style = "visibility: hidden; float: left;"/>');b=jQuery("#"+b);b.append(g.clone());var c=b.outerWidth(),e=b.outerHeight();a.debug&&(console.log("Contents width: "+c),console.log("Contents height: "+e));d.find("."+a.popupContentsContainerElementClass).css("width",c).css("height",e);b.remove();-1<a.maxWidthFactor&&c>a.maxWidthFactor*jQuery(window).width()&&(c*=a.maxWidthFactor*jQuery(window).width()/
c);-1<a.maxHeightFactor&&e>a.maxHeightFactor*jQuery(window).height()&&(e*=a.maxHeightFactor*jQuery(window).height()/e);-1<a.maxWidth&&c>a.maxWidth&&(c=a.maxWidth);-1<a.maxHeight&&e>a.maxHeight&&(e=a.maxHeight);-1<a.minWidth&&c<a.minWidth&&(c=a.minWidth);-1<a.minHeight&&e<a.minHeight&&(e=a.minHeight);-1<a.width&&(c=a.width);-1<a.height&&(e=a.height);a.debug&&(console.log("Final width: "+c),console.log("Final height: "+e));return{width:Math.ceil(c),height:Math.ceil(e)}}function k(b,c,e){if(p){var f=
u(0,0);d.css("visibility","visible").css("z-index",a.startZIndex+1).css("top",f.y).css("left",f.x).css("width",0).css("height",0);q=d.outerWidth();r=d.outerHeight();w=d.css("overflow");p=!1}d.css("visibility","visible").css("z-index",a.startZIndex+1);d.find("."+a.popupContentsContainerElementClass).css("width",b).css("height",c);a.debug&&(console.log("Extra width: "+q),console.log("Extra height: "+r));f=u(b+q,c+r);d.animate({top:f.y,left:f.x,width:b,height:c},{duration:a.animationDuration,easing:a.animationEasing,
queue:!1,complete:function(){d.css("overflow",w);var c=d.find("."+a.popupContentsContainerElementClass).width()-d.find("."+a.popupContentsElementClass).outerWidth();a.debug&&console.log("Adjustment: "+c);0<c&&(d.css("width",b+c),d.find("."+a.popupContentsContainerElementClass).css("width",b+c));e&&e()}})}function x(b,c){var e="popup-"+a.ID;d=jQuery("#"+e);0==d.length&&(jQuery(document.body).append('<div id = "'+e+'" class = "'+a.popupElementClass+'" style = "visibility: hidden; position: fixed;"></div>'),
d=jQuery("#"+e));g=b instanceof jQuery?b.clone():jQuery(b);d.empty();m(function(){d.append('<a class = "'+a.closeElementClass+'" href = "#" title = "'+a.closeElementTitle+'"><span>x</span></a><div class = "'+a.popupContentsContainerElementClass+'"><div class = "'+a.popupContentsElementClass+'"></div></div>').find("."+a.popupContentsElementClass).append(g);d.find("."+a.closeElementClass).css("z-index",a.startZIndex+2).click(function(){h();return!1});var b=n();k(b.width,b.height,c)})}function y(b,c){var e=
jQuery(window).width(),d=jQuery(window).height();if(z!=e||A!=d)z=e,A=d,a.beforeResizeCallback&&a.beforeResizeCallback(),m(function(){var b=n();k(b.width,b.height,function(){c&&c();a.afterResizeCallback&&a.afterResizeCallback()})})}function h(b){k(0,0,function(){jQuery(window).off("resize",l);jQuery(window).off("scroll",l);d.remove();C(function(){f.remove();a.destroyCallback&&a.destroyCallback();b&&b();p=!0})})}var a={animationDuration:300,animationEasing:"swing",overlayElementClass:"overlay",popupElementClass:"popup",
popupContentsElementClass:"popup-contents",popupContentsContainerElementClass:"popup-contents-container",closeElementClass:"close",closeElementTitle:"Close this popup",maxWidthFactor:.75,maxHeightFactor:.75,width:-1,height:-1,maxWidth:-1,maxHeight:-1,minWidth:-1,minHeight:-1,aspectRatio:4/3,keepAspectRatio:!1,startZIndex:1,createCallback:null,destroyCallback:null,beforeResizeCallback:null,afterResizeCallback:null,debug:!1};jQuery.extend(a,B);a.ID=""+(new Date).getTime();var f,d,g,p=!0,v,w,q=0,r=0,
z=jQuery(window).width(),A=jQuery(window).height(),l=t(y,100);x(this,a.createCallback);jQuery(document).keydown(function(a){27==(a.charCode||a.keyCode)&&h()});jQuery(window).on("resize",l);jQuery(window).on("scroll",l);return{destroy:h,position:t(y,100),getPopup:function(){return d},getContents:function(){return g},setContents:x,appendContents:function(b,c){g=g.add(b);d.find("."+a.popupContentsElementClass).append(b);m(function(){var b=n();k(b.width,b.height,function(){c&&c();a.afterResizeCallback&&
a.afterResizeCallback()})})},getParameter:function(b){return a[b]},setParameter:function(b,c){a[b]=c}}};
